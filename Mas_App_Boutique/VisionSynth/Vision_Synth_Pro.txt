<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vision Synth Pro</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Deep Navy */
        }
        .drag-drop-area {
            border: 2px dashed #6366f1;
            background-color: #1e293b;
            transition: all 0.3s ease;
        }
        .drag-drop-area.highlight {
            border-color: #4ade80;
            background-color: #0f172a;
            transform: scale(1.02);
        }
        #promptInput::placeholder {
            color: #64748b;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 10px;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div class="max-w-5xl w-full bg-slate-900 rounded-[2.5rem] shadow-[0_20px_50px_rgba(0,0,0,0.5)] border border-slate-800 overflow-hidden">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-indigo-700 to-blue-800 p-10 text-center relative">
            <h1 class="text-4xl md:text-5xl font-extrabold text-white tracking-tighter italic">
                VISION SYNTH <span class="text-indigo-300 not-italic">PRO</span>
            </h1>
            <p class="text-indigo-200 text-sm mt-3 font-medium tracking-[0.15em] uppercase opacity-90">
                Intelligent AI Image Synthesis & Command
            </p>
        </div>

        <div class="p-6 md:p-10 grid grid-cols-1 lg:grid-cols-12 gap-10">
            
            <!-- Sidebar / Input Controls (LHS) -->
            <div class="lg:col-span-5 space-y-8 flex flex-col">
                
                <!-- Prompt Section -->
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label for="promptInput" class="text-indigo-400 font-black text-xs uppercase tracking-widest">Semantic Input</label>
                        <span class="text-[10px] text-slate-500 font-mono">HYBRID ENGINE ACTIVE</span>
                    </div>
                    <textarea id="promptInput" rows="4" 
                        class="w-full p-5 bg-slate-950 border border-slate-800 rounded-3xl text-slate-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-900/50 transition-all custom-scrollbar outline-none"
                        placeholder="Define your vision or describe modifications..."></textarea>
                </div>

                <!-- Media Input Zone -->
                <div id="dropArea" class="drag-drop-area h-44 rounded-[2rem] flex flex-col items-center justify-center text-center p-6 cursor-pointer group">
                    <input type="file" id="fileInput" class="hidden" accept="image/*">
                    <div id="dropMessage" class="space-y-3">
                        <div class="bg-indigo-500/10 p-3 rounded-full inline-block group-hover:bg-indigo-500/20 transition-colors">
                            <svg class="w-8 h-8 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                        </div>
                        <div>
                            <p class="text-indigo-100 text-sm font-bold">Drop your image here</p>
                            <p class="text-slate-500 text-[10px] mt-1 uppercase tracking-wider">or click to browse</p>
                        </div>
                    </div>
                    <div id="fileInfo" class="hidden flex flex-col items-center">
                        <div class="w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center mb-2">
                             <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                        </div>
                        <p class="text-green-400 font-mono text-[10px] truncate max-w-[200px]" id="fileNameDisplay"></p>
                        <button id="clearFile" class="text-[9px] text-red-500 uppercase font-black tracking-tighter mt-2 hover:text-red-400">Remove Media</button>
                    </div>
                </div>

                <!-- Ratio Grid and Primary Action Buttons -->
                <div class="space-y-6">
                    <p class="text-indigo-400 font-black text-xs uppercase tracking-widest">Dimension Locking & Execution</p>
                    <div class="grid grid-cols-3 gap-4">
                        <!-- Column 1: 1:1 and Create New -->
                        <div class="flex flex-col space-y-4">
                            <button class="ratio-btn bg-slate-950 text-white py-4 rounded-2xl border-2 border-indigo-500 font-black text-sm hover:bg-slate-900 transition-all shadow-lg shadow-indigo-500/10" data-ratio="1:1">1:1</button>
                            <button id="generateButton" class="group relative bg-white hover:bg-indigo-50 text-slate-950 font-black py-5 rounded-2xl transition-all shadow-xl shadow-white/5 active:scale-[0.96] overflow-hidden">
                                <span class="relative z-10 uppercase tracking-widest text-[10px]">Create New</span>
                            </button>
                        </div>

                        <!-- Column 2: 16:9 -->
                        <div class="flex flex-col">
                            <button class="ratio-btn h-full bg-slate-950 text-slate-400 py-4 rounded-2xl border-2 border-slate-800 font-black text-sm hover:border-indigo-500/50 transition-all" data-ratio="16:9">16:9</button>
                        </div>

                        <!-- Column 3: 9:16 and Apply Edit -->
                        <div class="flex flex-col space-y-4">
                            <button class="ratio-btn bg-slate-950 text-slate-400 py-4 rounded-2xl border-2 border-slate-800 font-black text-sm hover:border-indigo-500/50 transition-all" data-ratio="9:16">9:16</button>
                            <button id="editButton" class="bg-indigo-600 hover:bg-indigo-500 text-white font-black py-5 rounded-2xl transition-all shadow-xl shadow-indigo-600/20 active:scale-[0.96]">
                                <span class="uppercase tracking-widest text-[10px]">Apply Edit</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Viewport & Execution (RHS) -->
            <div class="lg:col-span-7 space-y-6 flex flex-col">
                
                <!-- Display Box -->
                <div class="relative flex-grow min-h-[400px] flex items-center justify-center bg-slate-950 rounded-[2.5rem] border border-slate-800 shadow-inner overflow-hidden">
                    <div id="imageContainer" class="relative bg-slate-900 transition-all duration-500 shadow-2xl flex items-center justify-center overflow-hidden">
                        <img id="displayImage" class="absolute w-full h-full object-contain hidden z-10" src="" alt="Output">
                        <div id="placeholderText" class="text-slate-700 text-center z-0 p-8">
                            <div class="opacity-20 mb-4 flex justify-center">
                                <svg class="w-20 h-20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                            </div>
                            <p class="text-sm font-black uppercase tracking-[0.4em]">Awaiting Output</p>
                            <p class="text-[10px] mt-2 text-slate-600 font-mono">READY FOR GENERATION</p>
                        </div>
                    </div>
                    
                    <!-- Loading Mask -->
                    <div id="loadingOverlay" class="absolute inset-0 bg-slate-950/90 backdrop-blur-sm flex-col items-center justify-center hidden z-20">
                        <div class="relative">
                            <div class="w-16 h-16 border-4 border-indigo-500/20 border-t-indigo-500 rounded-full animate-spin"></div>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="w-8 h-8 bg-indigo-500 rounded-full animate-ping opacity-20"></div>
                            </div>
                        </div>
                        <p class="text-indigo-400 font-black mt-6 text-xs tracking-[0.3em] animate-pulse uppercase">Synthesizing Vision...</p>
                    </div>
                </div>

                <!-- Lower Secondary Controls -->
                <div class="grid grid-cols-2 gap-4">
                    <button id="generate169LetterboxButton" class="bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white py-3 rounded-2xl text-[9px] font-bold uppercase tracking-widest border border-slate-700 transition-all">
                        Force 16:9 Cinemascope
                    </button>
                    <button id="generate916LetterboxButton" class="bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white py-3 rounded-2xl text-[9px] font-bold uppercase tracking-widest border border-slate-700 transition-all">
                        Force 9:16 Vertical
                    </button>
                </div>

                <!-- Footer Utilities -->
                <div class="grid grid-cols-2 gap-4">
                    <button id="downloadImageButton" class="bg-emerald-600 hover:bg-emerald-500 text-white py-4 rounded-3xl text-xs font-black uppercase tracking-widest transition-all shadow-xl shadow-emerald-600/10 active:scale-[0.98]">
                        Download Image
                    </button>
                    <button id="clearImageButton" class="bg-slate-800 hover:bg-red-900/40 text-slate-400 hover:text-red-400 py-4 rounded-3xl text-xs font-black uppercase tracking-widest border border-slate-700 transition-all active:scale-[0.98]">
                        Wipe Output Buffer
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="bg-slate-950/50 p-4 text-center border-t border-slate-800/50">
            <span class="text-[9px] text-slate-600 font-mono tracking-widest">VISION SYNTH PRO // BUILD 2026.1 // STATUS: <span class="text-green-500">OPTIMAL</span></span>
        </div>
    </div>

    <script>
        const apiKey = ""; 

        const promptInput = document.getElementById('promptInput');
        const fileInput = document.getElementById('fileInput');
        const dropArea = document.getElementById('dropArea');
        const fileNameDisplay = document.getElementById('fileNameDisplay');
        const fileInfo = document.getElementById('fileInfo');
        const dropMessage = document.getElementById('dropMessage');
        const clearFile = document.getElementById('clearFile');
        const imageContainer = document.getElementById('imageContainer');
        const displayImage = document.getElementById('displayImage');
        const placeholderText = document.getElementById('placeholderText');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const generateButton = document.getElementById('generateButton');
        const editButton = document.getElementById('editButton');
        const clearImageButton = document.getElementById('clearImageButton');
        const downloadImageButton = document.getElementById('downloadImageButton');
        const ratioBtns = document.querySelectorAll('.ratio-btn');
        const generate169LetterboxButton = document.getElementById('generate169LetterboxButton');
        const generate916LetterboxButton = document.getElementById('generate916LetterboxButton');

        let currentBase64 = null;
        let selectedRatio = "1:1";

        // Ratio Controls
        ratioBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                ratioBtns.forEach(b => {
                    b.classList.replace('border-indigo-500', 'border-slate-800');
                    b.classList.replace('text-white', 'text-slate-400');
                });
                btn.classList.replace('border-slate-800', 'border-indigo-500');
                btn.classList.replace('text-slate-400', 'text-white');
                selectedRatio = btn.getAttribute('data-ratio');
                updateContainerRatio(selectedRatio);
            });
        });

        function updateContainerRatio(ratio) {
            imageContainer.classList.remove('aspect-square', 'aspect-video', 'aspect-[9/16]');
            imageContainer.style.width = '100%';
            imageContainer.style.height = 'auto';

            if (ratio === "1:1") {
                imageContainer.classList.add('aspect-square');
            } else if (ratio === "16:9") {
                imageContainer.classList.add('aspect-video');
            } else if (ratio === "9:16") {
                imageContainer.classList.add('aspect-[9/16]');
                imageContainer.style.width = 'auto';
                imageContainer.style.height = '100%';
            }
        }

        // Drop Zone Handler
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(n => dropArea.addEventListener(n, e => {e.preventDefault(); e.stopPropagation();}));
        ['dragenter', 'dragover'].forEach(n => dropArea.addEventListener(n, () => dropArea.classList.add('highlight')));
        ['dragleave', 'drop'].forEach(n => dropArea.addEventListener(n, () => dropArea.classList.remove('highlight')));

        dropArea.addEventListener('drop', e => handleFile(e.dataTransfer.files[0]));
        dropArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', e => handleFile(e.target.files[0]));

        function handleFile(file) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    currentBase64 = reader.result.split(',')[1];
                    fileNameDisplay.innerText = file.name;
                    dropMessage.classList.add('hidden');
                    fileInfo.classList.remove('hidden');
                };
            }
        }

        clearFile.addEventListener('click', (e) => {
            e.stopPropagation();
            currentBase64 = null;
            fileInput.value = '';
            dropMessage.classList.remove('hidden');
            fileInfo.classList.add('hidden');
        });

        async function processImage(isEdit, ratio, specialPrompt = null) {
            const prompt = specialPrompt || promptInput.value;
            if (!prompt) return showModal("INPUT REQUIRED", "Please describe what you want to create.");

            loadingOverlay.classList.remove('hidden');
            loadingOverlay.classList.add('flex');

            try {
                let result;
                if (isEdit) {
                    if (!currentBase64) throw new Error("Please upload an image to edit.");

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: prompt },
                                    { inlineData: { mimeType: "image/png", data: currentBase64 } }
                                ]
                            }],
                            generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
                        })
                    });
                    const data = await response.json();
                    const base64 = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                    if (base64) result = `data:image/png;base64,${base64}`;
                } else {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            instances: { prompt: prompt },
                            parameters: { sampleCount: 1, aspectRatio: ratio }
                        })
                    });
                    const data = await response.json();
                    const base64 = data.predictions?.[0]?.bytesBase64Encoded;
                    if (base64) result = `data:image/png;base64,${base64}`;
                }

                if (result) {
                    displayImage.src = result;
                    displayImage.classList.remove('hidden');
                    placeholderText.classList.add('hidden');
                } else {
                    throw new Error("The synthesis failed to produce an image.");
                }
            } catch (error) {
                console.error(error);
                showModal("SYNTHESIS ERROR", error.message);
            } finally {
                loadingOverlay.classList.add('hidden');
                loadingOverlay.classList.remove('flex');
            }
        }

        function showModal(title, msg) {
            const m = document.createElement('div');
            m.className = "fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-6 backdrop-blur-md";
            m.innerHTML = `
                <div class="bg-slate-900 border-2 border-indigo-500/50 p-8 rounded-[2rem] max-w-sm w-full text-center space-y-4 shadow-2xl shadow-indigo-500/10">
                    <h2 class="text-white font-black tracking-tight text-xl uppercase">${title}</h2>
                    <p class="text-slate-400 text-xs font-medium">${msg}</p>
                    <button class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold uppercase text-[10px] tracking-widest mt-4 hover:bg-indigo-500 transition-colors">Dismiss</button>
                </div>
            `;
            m.querySelector('button').onclick = () => m.remove();
            document.body.appendChild(m);
        }

        generateButton.addEventListener('click', () => processImage(false, selectedRatio));
        editButton.addEventListener('click', () => processImage(true, "1:1", "Perform an image-to-image edit based on the attached photo and the user's prompt: " + promptInput.value));
        
        generate916LetterboxButton.addEventListener('click', () => {
            const prompt = `Vertical cinematic composition: ${promptInput.value}. Render as a 9:16 vertical frame centered within a 1:1 square image. Fill the left and right empty spaces with pure black bars.`;
            processImage(false, "1:1", prompt);
        });

        generate169LetterboxButton.addEventListener('click', () => {
            const prompt = `Cinematic anamorphic widescreen: ${promptInput.value}. Render as a 16:9 horizontal frame centered within a 1:1 square image. Fill the top and bottom empty spaces with solid black letterbox bars.`;
            processImage(false, "1:1", prompt);
        });

        clearImageButton.addEventListener('click', () => {
            displayImage.classList.add('hidden');
            displayImage.src = '';
            placeholderText.classList.remove('hidden');
        });

        downloadImageButton.addEventListener('click', () => {
            if (!displayImage.src || displayImage.classList.contains('hidden')) {
                return showModal("DOWNLOAD ERROR", "No image found in output buffer.");
            }
            const link = document.createElement('a');
            link.href = displayImage.src;
            link.download = `VISION-SYNTH-${Date.now()}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        window.onload = () => updateContainerRatio("1:1");
    </script>
</body>
</html>