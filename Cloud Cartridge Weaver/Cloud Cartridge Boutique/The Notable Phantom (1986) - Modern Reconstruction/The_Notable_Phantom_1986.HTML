<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Notable Phantom - Cartridge Edition</title>
    <style>
        :root {
            --crt-green: #33ff33;
            --crt-bg: #050505;
            --crt-dim: #1a4d1a;
            --crt-glow: 0 0 10px rgba(51, 255, 51, 0.5);
        }

        * { box-sizing: border-box; }

        body {
            background-color: #000;
            color: var(--crt-green);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            text-transform: uppercase;
        }

        /* CRT Overlay Scanlines */
        body::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            z-index: 100;
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
        }

        #game-cartridge {
            width: 100%;
            max-width: 800px;
            height: 100vh;
            background: var(--crt-bg);
            border: 4px solid #222;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.8);
        }

        #visual-portal {
            width: 100%;
            height: 40%;
            border-bottom: 2px solid var(--crt-dim);
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        #visual-portal img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.6;
            filter: sepia(100%) hue-rotate(80deg) saturate(2) contrast(1.2);
        }

        .loading-text {
            font-size: 14px;
            letter-spacing: 4px;
            animation: pulse 1.5s infinite;
        }

        #text-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            font-size: 16px;
            line-height: 1.5;
            text-shadow: var(--crt-glow);
            scrollbar-width: none;
        }
        #text-area::-webkit-scrollbar { display: none; }

        .location-header {
            color: #fff;
            font-weight: bold;
            border-bottom: 1px solid var(--crt-dim);
            padding-bottom: 4px;
            display: inline-block;
        }

        .input-container {
            height: 60px;
            background: #000;
            border-top: 2px solid var(--crt-dim);
            display: flex;
            align-items: center;
            padding: 0 20px;
            position: relative;
            z-index: 10;
        }

        .prompt {
            color: var(--crt-green);
            font-weight: bold;
            margin-right: 15px;
            font-size: 18px;
        }

        #cmd-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--crt-green);
            font-family: inherit;
            font-size: 18px;
            outline: none;
            text-transform: uppercase;
            caret-color: var(--crt-green);
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .user-cmd { color: #888; font-style: italic; }
        .system-alert { color: #fff; font-weight: bold; }
        .help-box { border: 1px dashed var(--crt-dim); padding: 10px; color: #fff; font-size: 14px; }
    </style>
</head>
<body onclick="document.getElementById('cmd-input').focus()">

<div id="game-cartridge">
    <div id="visual-portal">
        <div class="loading-text" id="status-msg">INITIALIZING PHANTOM ARCHIVE...</div>
    </div>
    
    <div id="text-area">
        <div class="system-alert">THE NOTABLE PHANTOM (1982)</div>
        <div class="system-alert">RECONSTRUCTION LOADED.</div>
        <div style="color: #666">TYPE 'HELP' FOR COMMANDS.</div>
        <div style="color: #666">----------------------------------</div>
    </div>

    <div class="input-container">
        <span class="prompt">></span>
        <input type="text" id="cmd-input" placeholder="COMMAND" autofocus autocomplete="off">
    </div>
</div>

<script>
    const apiKey = ""; 

    const game = {
        loc: "GATES",
        inv: [],
        rooms: {
            GATES: {
                name: "Manor Gates",
                desc: "The iron gates are locked with a heavy chain. A cold wind blows from the North.",
                exits: { N: "DRIVEWAY" },
                items: ["KEY"]
            },
            DRIVEWAY: {
                name: "Gravel Driveway",
                desc: "Overgrown weeds reach for your legs. The manor looms to the North.",
                exits: { N: "FOYER", S: "GATES" },
                items: []
            },
            FOYER: {
                name: "Grand Foyer",
                desc: "The air is heavy with dust. To the East is a Library, West is a Dining Room. Stairs lead UP.",
                exits: { S: "DRIVEWAY", E: "LIBRARY", W: "DINING", U: "LANDING" },
                items: []
            },
            LIBRARY: {
                name: "The Library",
                desc: "Shelves of rotting books line the walls. A faint blue glow emanates from a Journal.",
                exits: { W: "FOYER" },
                items: ["JOURNAL"]
            },
            DINING: {
                name: "Dining Hall",
                desc: "A table is set for twelve. A Silver Medallion sits on a plate.",
                exits: { E: "FOYER" },
                items: ["MEDALLION"]
            },
            LANDING: {
                name: "Upper Landing",
                desc: "A long hallway leads North to the Master Bedroom.",
                exits: { D: "FOYER", N: "BEDROOM" },
                items: []
            },
            BEDROOM: {
                name: "Master Bedroom",
                desc: "The Notable Phantom stands here, translucent and weeping. He gestures toward his heart.",
                exits: { S: "LANDING" },
                items: []
            }
        },
        items: {
            KEY: { name: "A RUSTY KEY" },
            JOURNAL: { name: "A LEATHER JOURNAL" },
            MEDALLION: { name: "A SILVER MEDALLION" }
        }
    };

    const textArea = document.getElementById('text-area');
    const input = document.getElementById('cmd-input');
    const portal = document.getElementById('visual-portal');
    const status = document.getElementById('status-msg');

    async function getVisual(desc) {
        status.style.display = 'block';
        status.innerText = "RECONSTRUCTING SCENE...";
        
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    instances: { prompt: `vintage 1980s text adventure game illustration, pixelated, dithered, green monochrome, eerie atmosphere: ${desc}` },
                    parameters: { sampleCount: 1 }
                })
            });
            const result = await response.json();
            const b64 = result.predictions[0].bytesBase64Encoded;
            portal.innerHTML = `<img src="data:image/png;base64,${b64}">`;
            status.style.display = 'none';
        } catch (e) {
            status.innerText = "VISUAL DATA CORRUPT";
        }
    }

    function write(text, style = '') {
        const div = document.createElement('div');
        if(style) div.className = style;
        div.innerText = text;
        textArea.appendChild(div);
        textArea.scrollTop = textArea.scrollHeight;
    }

    function showHelp() {
        const helpDiv = document.createElement('div');
        helpDiv.className = 'help-box';
        helpDiv.innerHTML = `
            <strong>-- COMMAND STRUCTURE --</strong><br>
            MOVEMENT: N, S, E, W, U, D (or NORTH, SOUTH, etc.)<br>
            ACTIONS: TAKE [ITEM], DROP [ITEM], LOOK, INV<br>
            SPECIAL: GIVE [ITEM]<br>
            <br>
            EXAMPLES:<br>
            > GO NORTH<br>
            > TAKE KEY<br>
            > INV
        `;
        textArea.appendChild(helpDiv);
        textArea.scrollTop = textArea.scrollHeight;
    }

    function look() {
        const r = game.rooms[game.loc];
        write(r.name, 'location-header');
        write(r.desc);
        if(r.items.length) write("YOU SEE: " + r.items.map(i => game.items[i].name).join(", "));
        getVisual(r.name + " " + r.desc);
    }

    input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            const val = input.value.toUpperCase().trim();
            input.value = '';
            if(!val) return;

            write("> " + val, 'user-cmd');
            process(val);
        }
    });

    function process(cmd) {
        const parts = cmd.split(' ');
        const verb = parts[0];
        const noun = parts[1];

        if(verb === "HELP") {
            showHelp();
            return;
        }

        const dirs = { "N":"N", "NORTH":"N", "S":"S", "SOUTH":"S", "E":"E", "EAST":"E", "W":"W", "WEST":"W", "U":"U", "UP":"U", "D":"D", "DOWN":"D", "GO":"GO" };

        if(dirs[verb]) {
            let moveDir = dirs[verb];
            if(verb === "GO" && dirs[noun]) moveDir = dirs[noun];
            
            const next = game.rooms[game.loc].exits[moveDir];
            if(next) {
                game.loc = next;
                look();
            } else {
                write("YOU CANNOT GO THAT WAY.");
            }
            return;
        }

        if(verb === "TAKE" || verb === "GET") {
            const roomItems = game.rooms[game.loc].items;
            const idx = roomItems.findIndex(i => i === noun || game.items[i].name.includes(noun));
            if(idx !== -1) {
                const item = roomItems.splice(idx, 1)[0];
                game.inv.push(item);
                write("TAKEN.");
            } else {
                write("IT ISN'T HERE.");
            }
        } else if(verb === "INV" || verb === "I") {
            write("CARRYING: " + (game.inv.length ? game.inv.map(i => game.items[i].name).join(", ") : "NOTHING"));
        } else if(verb === "LOOK" || verb === "L") {
            look();
        } else if(verb === "GIVE" && noun === "MEDALLION" && game.loc === "BEDROOM") {
            if(game.inv.includes("MEDALLION")) {
                write("THE PHANTOM ACCEPTS THE TOKEN. HE DISSIPATES INTO A SOFT LIGHT.");
                write("THE CURSE IS LIFTED. YOU HAVE WON.");
            } else {
                write("YOU DON'T HAVE IT.");
            }
        } else {
            write("I DON'T KNOW HOW TO " + verb);
        }
    }

    window.onload = look;
</script>

</body>
</html>